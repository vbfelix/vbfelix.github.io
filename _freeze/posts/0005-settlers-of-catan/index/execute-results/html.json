{
  "hash": "3708ee2831d465e5469074caf16fd038",
  "result": {
    "markdown": "---\ntitle: \"An analysis of: Settlers of Catan\"\nauthor: \"Vinícius Félix\"\ndate: \"2023-01-14\"\ncategories: [An analysis of, Probability]\nimage: \"an-analysis-of-settlers-of-catan.png\"\n---\n\n\nIn this post you will learn how statistics and probability can help you to win a board game.\n\n\n::: {.cell}\n\n:::\n\n\n# Context\n\nSettlers of Catan, or just [Catan](https://www.catan.com/) is a board game designed by [Klaus Teuber](https://en.wikipedia.org/wiki/Klaus_Teuber \"Klaus Teuber\"). In the game we take the role of settlers.\n\n![Catan set. Source: catan.com.](https://www.catan.com/sites/default/files/2021-06/dye_catan_150407_0564.jpg){alt=\"Catan set. Source: catan.com\" width=\"279\"}\n\nThe game has 19 locations, where:\n\n| Location | Resource | Number of locations |\n|----------|----------|---------------------|\n| Pasture  | Wool     | 4                   |\n| Hill     | Brick    | 3                   |\n| Mountain | Ore      | 3                   |\n| Field    | Grain    | 4                   |\n| Forest   | Lumber   | 4                   |\n| Desert   | None     | 1                   |\n\nWith the exception of the desert, each location will have a number. This number is one of the possible outcomes of the sum of two dice, so they can range from 2 to 12. The number 7 will result in the action of the robber, where you can choose to block one location and steal one random resource from a player who is present there.\n\nThe main goal of the game is to achieve 10 points (**P**), to achieve points we have structures:\n\n-   **Road**: 1 brick + 1 lumber;\n\n-   **(1P) Settlement**: 1 Brick + 1 lumber + 1 wool + 1 grain;\n\n-   **(2P) City**: 3 ores + 2 grains.\n\nWe also have the **development card**: 1 ore + 1 wool + 1 grain, which you draw randomly from a deck of cards with different effects, one of them been cards that award you **1P.**\n\nAnd lastly, achievements:\n\n-   **(2P) Longest road:** the player that first achieve a sequencial road of size 5;\n\n-   **(2P) Largest army:** the player that first uses 3 knight cards (**development card**).\n\nFor more in-depth information check the rules in the [official site](https://www.catan.com/).\n\n\n\n\n\n# Analysis\n\nFor the analysis we will use the dataset [My Settlers of Catan Games](https://www.kaggle.com/datasets/lumins/settlers-of-catan-games) from the user Lumin of Kaggle.\n\n> **Disclaimer:** this dataset has only 50 observations, with one of the players always being the same, and with a winrate of 50%, so the goal here is simply to look at the data and check some hypotheses, rather than to do an inference or study about the game.\n\n## Is the dice fair?\n\nEvery turn, each player rolls two dice and adds their totals together to determine which location will grant resources to players who have cities or settlements there. This will be the subject of the first analysis.\n\nWe will compute the probability of each result for the sum of the two dices, taking into account that there are six possible outcomes for each face of each die.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nIn the picture above, we can see a graph where each axis represents the outcome of a single die, and we can also see all possible outcomes of the sum of those dices.\n\nSome outcomes are more common than others, for example, the number 7 is the most common outcome because it appears six times.\n\nAnother intriguing finding is that the results exhibit symmetry; to further explore this, let's use another visual representation.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nThe extreme results, 2, and 12, with only one combination for each, are symmetrical and center on the number 7, as was previously mentioned.\n\nWe will now compare the observed data to the predicted result.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nWhen comparing the observed values from the real dataset, we can see that the dice results appear to be fairly random because they closely resemble our anticipated result. The number 4 had the biggest discrepancy, with observed values 1.02 percentage points below the predicted probability.\n\n## \"Spending money to make money.\"\n\nIn the dataset we have the following concepts, as described by the author:\n\n-   **Production gain:** Cards gained from structures;\n\n-   **Trade gain:** Cards gained from peer or bank trade;\n\n-   **Non-production gain:** Cards gained from stealing with the robber, plus cards gained with non-knight development cards, e.g., a road building card is +4 resources;\n\n-   **Total gain:** Production + Trade + Non-production;\n\nAlso we have the ways to loss cards\n\n-   **Trade loss:** Cards lost from peer or bank trades;\n\n-   **Robber loss:** Cards lost directly from robbers, knights, and other players' monopoly cards;\n\n-   **Tribute loss:** Cards lost when player had to discard on a 7 roll;\n\n-   **Total loss:** Trade + Robber + Tribute.\n\nFirst of all, let's see how the total gain and loss relate.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nWe see in the figure above that:\n\n1.  The loss and gain are positive correlated, that means that players that gained more also lost more cards;\n\n2.  There is no player that lost more than gained, as no point is below the identity line;\n\n3.  The winners gained a lot more cards than player that lost.\n\nTo take a better look at the third point, let's plot the gain/loss cards ratio.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nLooking at the gain/loss ratio density plot, we see that:\n\n-   The density is positive skewed, for winners or losers;\n\n-   The losers have a more concentrated density, using the peak value of the density as a metric, winners gain 2.31 cards to every card lost, whereas losers gain 2.15 cards.\n\n## \"The last will be first, and the first last.\"\n\nThe playing order is important in this game because it gives you the ability to choose the locations of your settlement, but being the last one is not the worst, since you become the first to choose your second settlement in the map.\n\nTo make the analysis of the importance of the locations choosen, we will use the dice sum results and define as weights, e.g., if the number is 12 the weight will be 1, since the the probability of this results is 1/36, as we saw in the dice analysis.\n\nThen we will sum the weights of the initial two settlements of each player ($wt$), and we will do the different of the total weight of the winner minus the maximum weight of that game, given by:\n\n$$\nwt_{\\mathrm{winner}} - \\max(wt).\n$$\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> Difference </th>\n   <th style=\"text-align:center;\"> Frequency </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> -5 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> -4 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> -3 </td>\n   <td style=\"text-align:center;\"> 8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> -2 </td>\n   <td style=\"text-align:center;\"> 8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> -1 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> 0 </td>\n   <td style=\"text-align:center;\"> 24 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nA difference of zero means that the winner was the player with the best location, at least probability-wise. So in almost half of the games the winner had the best location.\n\n## \"If your ship doesn't come in, swim out and meet it.\"\n\n\n::: {.cell}\n\n:::\n\n\nThe port is a unique location. Normally, you can exchange 4 identical resources for another resource at the bank, but with a port you can lower this trade rate, but you lose one resource location in the process.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> Location </th>\n   <th style=\"text-align:center;\"> Locations </th>\n   <th style=\"text-align:center;\"> Percentage </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> Port </td>\n   <td style=\"text-align:center;\"> 35 </td>\n   <td style=\"text-align:center;\"> 2.92 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> Resource </td>\n   <td style=\"text-align:center;\"> 1,165 </td>\n   <td style=\"text-align:center;\"> 97.08 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> Total </td>\n   <td style=\"text-align:center;\"> 1,200 </td>\n   <td style=\"text-align:center;\"> 100.00 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nSo of all the 1,200 initial settlements just 35 of them were ports, so it is not a popular strategy.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:center;\"> Player </th>\n   <th style=\"text-align:center;\"> Games </th>\n   <th style=\"text-align:center;\"> Percentage </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;\"> Loser </td>\n   <td style=\"text-align:center;\"> 27 </td>\n   <td style=\"text-align:center;\"> 81.82 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> Winner </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 18.18 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;\"> Total </td>\n   <td style=\"text-align:center;\"> 33 </td>\n   <td style=\"text-align:center;\"> 100.00 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThose 35 port initial locations were in 33 games, where in only 6 of them the player was the winner, let's explore why.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nLooking at the trading behavior we see that in average player with a initial port gained more, so let's take a look at the trade ratio (gain/loss).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\nPlayers that had a initial port had a higher ratio, that can sound counterintuitive, since we expect they had a better trade-off with the ports advantage, a possibility is the lower quantity of resources making the players make actually worst trade for other resources, since they give up one location when choosing this strategy, but how impactful is that?\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nLastly, when can see how impactful was the production of cards from structures based on the initial port. The result was a lot lower for players with a initial port, with almost 16 cards of difference from players that choosed 3 resources locations.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}